import org.apache.tools.ant.taskdefs.condition.Os

class RunCmdTask extends Exec {
    String execPath

    @Override
    protected void exec() {
        if (Os.isFamily(Os.FAMILY_WINDOWS)) {
            commandLine 'cmd', '/c', execPath
        } else if (Os.isFamily(Os.FAMILY_UNIX)) {
            commandLine './' + execPath
        } else if (Os.isFamily(Os.FAMILY_MAC)) {
            //todo
        }
        super.exec()
    }

    RunCmdTask() {
        group = 'cmd'
//        outputs.upToDateWhen { false }
    }
}

task buildRdCpp(type: RunCmdTask) {
    workingDir '.'
    execPath = 'build.cmd'
}

task buildRdCppTest(type: RunCmdTask, dependsOn: [':generateEverything']) {
    workingDir '.'
    execPath 'buildtest.cmd'
}

class RunExecTask extends Exec {
    String execPath

    @Override
    protected void exec() {
        println execPath

        if (Os.isFamily(Os.FAMILY_WINDOWS)) {
            commandLine 'cmd', '/c', execPath + '.exe'
        } else if (Os.isFamily(Os.FAMILY_UNIX)) {
            commandLine './' + execPath
        } else if (Os.isFamily(Os.FAMILY_MAC)) {
            //todo
        }
        super.exec()
    }

    RunExecTask() {
        group = 'exec'
        outputs.upToDateWhen { false }
    }
}

task runCrossTestClientAllEntities(type: RunExecTask, dependsOn: ['buildRdCppTest']) {
    workingDir 'build/src/rd_gen_cpp/test/cross_test/Release/'
    execPath 'cross_test_client_all_entities'
}