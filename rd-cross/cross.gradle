import com.jetbrains.rd.gradle.tasks.*

import static com.jetbrains.rd.gradle.tasks.CrossTaskKt.*

dependencies {
//    testCompileOnly files { project(':rd-framework:').sourceSets.test.kotlin.srcDirs }
//    compile project(':rd-framework:').sourceSets.test.output
    compile project(':rd-framework:')
    implementation gradleApi()
}

task CrossTestKtServerAllEntities(type: KotlinExec, dependsOn: tasks.getByPath(':rd-framework:jvmTestClasses')) {
    classpath += project.sourceSets.test.runtimeClasspath
    classpath += project.sourceSets.test.compileClasspath
    classpath += files('../rd-kt/rd-framework/build/classes/kotlin/jvm/test')
    main = 'com.jetbrains.rd.framework.test.cross.CrossTestKtServerAllEntitiesKt'
    args getTmpFilePath(it)
//todo temporary hack
}

task CrossTestKtCppAllEntities(type: InteropTask) {
    taskServer = CrossTestKtServerAllEntities
    taskClient = project(':rd-cpp').getTasksByName('CrossTestCppClientAllEntities', true).iterator().next()

    addDependencies()
}

task crossTest() {
    dependsOn 'CrossTestKtCppAllEntities'
}